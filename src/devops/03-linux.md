## 系统管理

### free 查看内存使用情况

`free [ 选项 ]`

- `-b` 以 byte 显示内存使用情况
- `-k` 以 kb 显示内存使用情况
- `-m` 以 mb 显示内存使用情况
- `-s` 指定刷新间隔

```shell :no-line-numbers
free -ms 2
```

### ps 查看进程

`ps [ 选项 ]`

- `-ef` 显示所有进程
- `-u [ user ]` 显示指定用户进程
- `-au[ x ]` 显示所有包含其他使用者的进程

```shell :no-line-numbers
# 查看所有进程过滤 nginx 进程
ps -ef | grep nginx
```

结果分析

| 标题 | 说明 |
| --- | --- |
| USER | 用户名 |
| PID | 进程号 |
| %CPU | 占用 CPU 百分比 |
| %MEM | 占用内存百分比 |
| VSZ | 占用虚拟内存 |
| RSS | 占用物理内存 |
| TTY | 终端名 |
| STAT | 进程状态 <br> `D` 不可中断的睡眠状态，<br>  `R` 正在运行， <br> `S` 睡眠，<br> `T` 跟踪/停止，<br> `Z` 僵尸进程 <br> `<` 高优先级 <br> `N` 低优先级|
| START | 启动时间 |
| TIME | 运行时间 |
| COMMAND | 所执行的指令 |

### top 查看进程（实时）

`top [ 选项 ]`

- `-d` 指定刷新间隔
- `-p` 指定进程号
- `-n` 指定刷新次数，到达次数后退出
- `-i` 不显示闲置或僵尸进程
- `-u` 显示指定用户名进程


### kill 终止进程

`kill [ 选项 ] 进程号` 默认会发送 `SIGTERM` 信号，默认是 `15` 也可以通过 `-[num]` 指定发送的信号

- `-9` `SIGKILL` 立即结束进程，不能捕获或忽略
- `-15` `SIGTERM` 正常结束进程，可以捕获或忽略
- `-19` `SIGSTOP` 暂停进程，不能捕获、忽略或结束
- `-18` `SIGCONT` 继续运行暂停的进程

### chmod 修改文件权限

![alt text](/devops/08.png)
![alt text](/devops/09.jpg)

`chmod 权限 文件名` 权限的修改整体分为三部分； **给谁权限、增或减少权限、赋予什么权限**

> [!TIP]
> `-u` 所有者 Owner；`-g` 所属组；`-o` 其他人；`-a` 所有人
>
> `+` 添加权限；`-` 减少权限；`=` 设置权限
>
> `r` 读权限；`w` 写权限；`x` 执行权限
>
> ``` shell :no-line-numbers
> # 给 a.txt 文件所有者添加执行权限
> chmod u+x a.txt
> 
> # 给所有用户添加读写执行权限
> chmod a+rwx a.txt
> ```
> 也可以通过 8 进制数字进行权限设置，**`1` 表示执行，`2` 表示写权限，`4` 表示读权限。(1 + 2 + 4 = 7)**，常用组合如下。
> - `755: rwxr-xr-x`
> - `644: rw-r--r--`
> - `700: rwx------`
> - `777: rwxrwxrwx`
>
> ``` shell :no-line-numbers
> # 给 a.txt 文件所有用户增加执行权限
> chmod 111 a.txt
>

### df 查看磁盘使用情况

`df [ 选项 ] [ 文件 ]`

- `-l` 进现实本地磁盘 (默认)
- `-a` 显示所有文件系统信息
- `-T` 显示磁盘分区类型
- `-t` 显示指定类型文件系统的磁盘分区
- `-H` 以 `1000` 进制显示
- `-h` 以 `1024` 进制显示
- `-x` 不显示指定文件类型的磁盘分区

示例
```shell :no-line-numbers
# 以 1024 进制显示 /dev/shm 分区信息
df -ht tmpfs
```

### du 统计磁盘上文件大小

`du [ 选项 ] [ 文件 ]`

- `-b` 以 byte 显示统计文件
- `-k` 以 kb 显示统计文件
- `-m` 以 mb 显示统计文件
- `-h` 以 `1024` 进制显示
- `-H` 以 `1000` 进制显示
- `-s` 只显示总和

示例

```shell :no-line-numbers
# 以 1024 进制显示 /tmp 目录下所有文件大小
du -h /tmp

# 以 1024 进制显示 /tmp 目录下所有文件大小，只显示总和
du -s /tmp
```

### fdisk 查看磁盘分区

`fdisk [ 选项 ] 设备`

- `-l`  列出所有分区
- `-u`  与 `-l` 搭配，显示分区数目

示例

```shell :no-line-numbers
fdisk -lu
```

## vi/vim 编辑器

![alt text](/devops/vi.png)

`vim 文件名`

### 三种模式

![alt text](/devops/mode.png)

### 命令模式

打开文件后默认进入命令模式，按照 `i o a` 进入编辑模式，按 `ESC` 键再次进入命令模式。

命令模式下，按 `:` 进入底线命令模式。

- `Control + f` 向下翻页
- `Control + b` 向上翻页
- `0` 移动到行首
- `$` 移动到行尾
- `n + enter` 向下移动 n 行
- `n + space` 向右移动 n 个字符
- `gg` 移动到文档第一行
- `G` 移动到文档最后一行
- `dd` 删除光标所在行
- `ndd` 删除光标所在行向下 n 行
- `yy` 复制光标所在行
- `nyy` 复制光标所在行向下 n 行
- `p/P` p 粘贴到光标所在行下方，P 粘贴到光标所在行上方
- `u` 撤销上一次操作

### 底线命令模式

在命令模式下输入 `:` 进入底线命令模式。

- `w` 保存
- `q` 退出
- `q!` 强制退出，若曾修改过档案，又不想储存，使用 ! 为强制离开不储存档案
- `wq` 保存并退出
- `set nu` 显示行号
- `set nonu` 取消行号
- `ESC` 退出编辑模式，进入命令模式
- `%s/old/new` 替换光标所在行的第一个字符串, `%s/old/new/g` 替换行中所有字符串

**命令和底线命令模式都能使用**

- `/字符串` 向下搜索字符串
- `?字符串` 向上搜索字符串
    - `n` 下一个
    - `N` 上一个

### 编辑模式

在命令模式下输入以下内容进行编辑模式。

- `i` 在光标所在字符前插入
- `a` 在光标所在字符后插入
- `o` 在光标所在行下插入新行
- `ESC` 退出编辑模式，进入命令模式

## 磁盘管理

### fdisk 管理磁盘分区

`fdisk [ 选项 ] 设备`

- `-l`  列出所有分区
- `-u`  与 `-l` 搭配，显示分区数目

示例

```shell :no-line-numbers
fdisk -lu
```

`fdisk /dev/sdb` 进入分区管理界面，输入 `m` 查看帮助信息。

![alt text](/devops/07.png)